#!/usr/bin/perl -w

# flags:
# ORDER       n
# FORMATIPF   "sprintf string"
# FORMATIPC   "sprintf string"
# FORMATIPT   "sprintf string"
# ISFLIP      BOOL
# ISSINGLE    BOOL
# ISMULTI     BOOL
# ISACTION    BOOL
# ISPOLICY    BOOL



my %parm = (
    'action'    => [[500,"-j %s","-j %s","-j %s",0,0,1,0,0],
	[]],
    'chain'     => [[20,"-A %s","-A %s","-A %s",0,0,1,0,0],
	['chain']],
    'interface' => [[30,"-i %s","-i %s","-i %s",0,0,1,0,0],
	['interface','if']],
    'outerface' => [[40,"","-o %s","-o %s",0,0,1,0,0],
	['outerface','out-interface','of']],
    'proto'     => [[50,"-p %s","-p %s","-p %s",0,0,1,0,0],
	['protocol','proto']],
    'sport'     => [[60,"","--sport %s","--sport %s",0,0,1,0,0],
	['sport']],
    'dport'     => [[70,"","--dport %s","--dport %s",0,0,1,0,0],
	['dport']],
    'saddr'     => [[80,"","--saddr %s","--saddr %s",0,0,1,0,0],
	['saddr']],
    'daddr'     => [[90,"","--daddr %s","--daddr %s",0,0,1,0,0],
	['daddr']],
    'icmptype'  => [[0,"","","",0,0,0,0,0],
        ['icmptype','icmp-type']],
    'settos'    => [[0,"","","",0,0,0,0,0],
	['settos']],
    'tos'       => [[0,"","","",0,0,0,0,0],
	['tos']],
    'setftos'   => [[0,"","","",0,0,0,0,0],
	['setftos','set-ftos']],
    'mark'      => [[0,"","","",0,0,0,0,0],
	['mark']],
    'setmark'   => [[0,"","","",0,0,0,0,0],
	['set-mark','setmark']],
    'tcpflags'   => [[0,"","","",0,0,0,0,0],
	['tcp-flags','tcpflags','flags']],
    'tcpoption' => [[0,"","","",0,0,0,0,0],
	['tcp-option','tcpoption']],
    'mac'       => [[0,"","","",0,0,0,0,0],
	['mac','mac-source','macsource']],
    'limit'     => [[0,"","","",0,0,0,0,0],
	['limit']],
    'iplimitabove' => [[0,"","","",0,0,0,0,0],
	['iplimitabove','ip-limit-above']],
    'iplimitmask' => [[0,"","","",0,0,0,0,0],
	['iplimitmask','ip-limit-mask']],
    'burst'     => [[0,"","","",0,0,0,0,0],
	['burst','limit-burst','limitburst']],
    'uidowner'  => [[0,"","","",0,0,0,0,0],
	['uid-owner','uidowner','uid']],
    'gidowner'  => [[0,"","","",0,0,0,0,0],
	['gid-owner','gidowner','gid']],
    'pidowner'  => [[0,"","","",0,0,0,0,0],
	['pid-owner','pidowner','pid']],
    'sidowner'  => [[0,"","","",0,0,0,0,0],
	['sid-owner','sidowner','sid']],
    'psdweightthreshold' => [[0,"","","",0,0,0,0,0],
	['psdweightthreshold','psd-weight-threshold']],
    'psddelaythreshold' => [[0,"","","",0,0,0,0,0],
	['psddelaythreshold','psd-delay-threshold']],
    'psdloportsweight' => [[0,"","","",0,0,0,0,0],
	['psdloportsweight','psd-lo-ports-weight']],
    'psdhiportsweight' => [[0,"","","",0,0,0,0,0],
	['psdhiportsweight','psd-hi-ports-weight']],
    'length'    => [[0,"","","",0,0,0,0,0],
	['length']],
    'state'     => [[0,"","","",0,0,0,0,0],
	['state']],
    'loglevel'  => [[0,"","","",0,0,0,0,0],
	['log-level','loglev']],
    'logprefix' => [[0,"","","",0,0,0,0,0],
	['log-prefix','logprefix']],
    'logtcpsequence' => [[0,"","","",0,0,0,0,0],
	['log-tcp-sequence','logseq']],
    'logtcpoptions' => [[0,"","","",0,0,0,0,0],
	['log-tcp-options','logtcpopt']],
    'logipoptions' => [[0,"","","",0,0,0,0,0],
	['log-ip-options','logipopt']],
    'module'    => [[0,"","","",0,0,0,0,0],
	['module','mod','match']],
    'table'     => [[10,"","","-t %s",0,0,1,0,0],
	['table']],
    'reject-with' => [[0,"","","",0,0,0,0,0],
	['reject-with','rejectwith']],
    'ttl'       => [[0,"","","",0,0,0,0,0],
	['ttl']],
    'ttlset'    => [[0,"","","",0,0,0,0,0],
	['ttl-set','ttlset']],
    'ttlinc'    => [[0,"","","",0,0,0,0,0],
	['ttl-inc','ttlinc']],
    'ttldec'    => [[0,"","","",0,0,0,0,0],
	['ttl-dec','ttldec']],
    'ttleq'     => [[0,"","","",0,0,0,0,0],
	['ttl-eq','ttleq']],
    'ttllt'     => [[0,"","","",0,0,0,0,0],
	['ttl-lt','ttllt']],
    'ttlgt'     => [[0,"","","",0,0,0,0,0],
	['ttl-gt','ttlgt']],
    'every'     => [[0,"","","",0,0,0,0,0],
	['every']],
    'counter'   => [[0,"","","",0,0,0,0,0],
	['counter']],
    'start'     => [[0,"","","",0,0,0,0,0],
	['start']],
    'packet'    => [[0,"","","",0,0,0,0,0],
	['packet']],
    'average'   => [[0,"","","",0,0,0,0,0],
	['average']],
    'pkttype'   => [[0,"","","",0,0,0,0,0],
	['pkttype','pkt-type']],
    'string'    => [[0,"","","",0,0,0,0,0],
	['string']],
    'timestart' => [[0,"","","",0,0,0,0,0],
	['timestart','timestop','days']],
    'nldrop'    => [[0,"","","",0,0,0,0,0],
	['nldrop']],
    'nlmark'    => [[0,"","","",0,0,0,0,0],
	['nlmark','nlsize']],
    'reverse'   => [[0,"","","",0,0,0,0,0],
	['reverse','bidirectional','swap']],
    'log'       => [[0,"","","",0,0,0,0,0],
	['log']],
    'syn'       => [[0,"","","",0,0,0,0,0],
	['syn']],
    'fragment'  => [[0,"","","",0,0,0,0,0],
	['fragment','frag']],
    'to'        => [[0,"","","",0,0,0,0,0],
	['to']],
    'toports'   => [[0,"","","",0,0,0,0,0],
	['toports','to-ports']],
    'tosrc'     => [[0,"","","",0,0,0,0,0],
	['tosrc','to-source']],
    'todest'    => [[0,"","","",0,0,0,0,0],
	['todest','to-destination']],
    'goto'      => [[0,"","","",0,0,0,0,0],
	['goto','jump']],
    'policy'    => [[0,"","","",0,0,0,0,0],
	['policy']],

    'accept'    => [[0,"","","",0,0,0,1,1],
	['ACCEPT','accept']],
    'reject'    => [[0,"","","",0,0,0,1,1],
	['REJECT','reject']],
    'queue'     => [[0,"","","",0,0,0,1,0],
	['QUEUE','queue']],
    'drop'      => [[0,"","","",0,0,0,1,1],
	['DROP','drop','DENY','deny']],
    'LOG'       => [[0,"","","",0,0,0,1,0],
	['LOG']],
    'masq'      => [[0,"","","",0,0,0,1,1],
	['MASQ','masq']],
    'proxy'     => [[0,"","","",0,0,0,1,0],
	['PROXY','proxy','REDIRECT','redirect']],
    'dnat'      => [[0,"","","",0,0,0,1,0],
	['DNAT','dnat']],
    'snat'      => [[0,"","","",0,0,0,1,0],
	['SNAT','snat']],
    'nop'       => [[0,"","","",0,0,0,1,0],
	['NOP','nop']],
    'mirror'    => [[0,"","","",0,0,0,1,0],
	['MIRROR','mirror']],
    'return'    => [[0,"","","",0,0,0,1,0],
	['RETURN','return']],
    'tos'       => [[0,"","","",0,0,0,1,0],
	['TOS','tos']],
    'mark'      => [[0,"","","",0,0,0,1,0],
	['MARK','mark']],
    'ttl'       => [[0,"","","",0,0,0,1,0],
	['TTL','ttl']],
    'ftos'      => [[0,"","","",0,0,0,1,0],
	['FTOS','ftos']],
    'balance'   => [[0,"","","",0,0,0,1,0],
	['BALANCE','balance']],
    'netlink'   => [[0,"","","",0,0,0,1,0],
	['NETLINK','netlink']],
);

my %revbyalias_parm;
my %revbyorder_parm;

foreach $key ( keys %parm) {
    @flags = @{ $parm{$key}[0] };
    @aliases = @{ $parm{$key}[1] };
    foreach $n (0..$#aliases) {
	$revbyalias_parm{$aliases[$n]} = [ [ @flags ] , $key ];
    };
};

foreach $key (keys %parm) {
    @flags = @{ $parm{$key}[0] };
    @aliases = @{ $parm{$key}[1] };
    $revbyorder_parm{$parm{$key}[0][0]} = [ [ @flags ] , $key ] ;
};


print "my %parm = (\n";
foreach $key ( sort { $parm{$a}[0][0] <=> $parm{$b}[0][0] || $a cmp $b }  keys %parm ) {
    @flags = @{ $parm{$key}[0] };
    @aliases = @{ $parm{$key}[1] };

    print "    '" . $key . '\' => ' . '[ [ ';
    foreach $m ( 0, 3, 4, 5, 6, 7 ) {
        print "'" . $flags[$m] . "', ";
    };
    print "'" . $flags[$#flags] . "' ],\n";

    print "\t [";
    foreach $m ( 0 .. $#aliases-1 ) {
        print "'" . $aliases[$m] . "', ";
    };
    if ( $#aliases > 0 ) {
	 print "'" . $aliases[$#aliases] . "'";
    };
    print " ] ],\n";
};
print ");\n";


print "my %revbyalias_parm = (\n";
foreach $key ( sort { uc($b) cmp uc ($a) || $b cmp $a } keys %revbyalias_parm ) {
    @flags = @{ $revbyalias_parm{$key}[0] };
    $alias = $revbyalias_parm{$key}[1];

    print "    " . $key . ' => ' . '[ [ ';
    foreach $m ( 0 .. $#flags-1 ) {
        print "\"" . $flags[$m] . "\", ";
    };
    print "\"" . $flags[$#flags] . "\" ]\n";
    print "\t [\"" . $alias . "\" ] ],\n";
};
print ");\n";

print "my %revbyorder_parm = (\n"; 
foreach $key (sort {$a <=> $b} keys %revbyorder_parm) {
    @flags = @{ $revbyorder_parm{$key}[0] };
    $alias = $revbyorder_parm{$key}[1];

    print "    " . $key . ' => ' . '[ [ ';
    foreach $m ( 0 .. $#flags-1 ) {
        print "\"" . $flags[$m] . "\", ";
    };
    print "\"" . $flags[$#flags] . "\" ]\n";

    print "\t [\"" . $alias . "\" ] ],\n";
};
print ");\n";


