.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH FERM 1 "ferm 1.0pl8" "16/Jul/101" "FIREWALL RULES MADE EASY"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
\fBferm\fR \- a firewall rule parser for linux
.SH "SYNOPSYS"
\fBferm\fR \fIoptions\fR \fIinputfiles\fR
.SH "DESCRIPTION"
\fBferm\fR compiles ready to go firewall-rules from a structured
rule-setup. These rules will be executed by the preferred kernel
interface, such as \fIipchains\fR\|(8) and \fIiptables\fR\|(8).
.PP
Besides just executing all rules in one command, the obvious gain
is the possibility to provide a structured description of a
firewall. No need anymore for tedious typing all firewalls into
custom scripts, you can now write logically and coherent rules
using a C\-style nesting structure, and let \fBferm\fR create all
rules for you.
.PP
\fBferm\fR will also aid in modularizing firewalls, because it
creates the possibility to split up the firewall into several
different files, which can be reloaded at will, so you can
dynamically adjust your rules.
.PP
\fBferm\fR, pronounced \*(L"firm\*(R", stands for \*(L"For Easy Rule Making\*(R".
.SH "STRUCTURE OF A FIREWALL FILE"
The structure of a proper firewall file looks like  simplified
C\-code. Only a few syntactic characters are used in ferm-
configuration files. Besides these special caracters, ferm
uses \*(L'keys\*(R' and \*(L'values\*(R', think of them as options and
parameters, or as variables and values, whatever.
.PP
With these words, you define the characteristics of your firewall.
Every firewall consists of two things: First, look if network
traffic matches certain conditions, and second, what to do
with that traffic.
.PP
You may specify conditions that are valid for the kernel
interface program you are using, probably \fIiptables\fR\|(8). For
instance, in iptables, when you are trying to match tcp
packets, you would say:
.PP
.Vb 1
\&    iptables --protocol tcp
.Ve
In ferm, this will become:
.PP
.Vb 1
\&    protocol tcp;
.Ve
Just typing this in ferm doesn't do anything, you need to tell
ferm (actually, you need to tell \fIiptables\fR\|(8) and the kernel) what
to do with any traffic that matches this condition:
.PP
.Vb 1
\&    iptables --protocol tcp -j ACCEPT
.Ve
Or, translated to \fBferm\fR:
.PP
.Vb 1
\&    protocol tcp accept;
.Ve
Noticed the \fB;\fR character? We're getting to that now, because there
are some special characters in \fBferm\fR that make life easy.
.PP
Here's a list of the special characters:
.Ip "\fB;\fR" 8
The effectuation character. This character defines the end of
a rule. Anything defined before this character will be put
into one or more rules.
.Sp
This character *makes* the rule. It gathers all the information, all
parameters and targets, special things or whatever, that currently
is \*(L'valid\*(R', and tries to make a decent rule out of it. \fBferm\fR will
do nothing without this character!
.Sp
Example:
.Sp
.Vb 1
\&    proto tcp ACCEPT;
.Ve
THis example shows a single rule, defined by two keys and one
value.
.Ip "\fB{}\fR" 8
The nesting symbol defines a \*(L'block\*(R' of rules.
.Sp
Anything defined before this block will
still be available within all rules inside this block. You can
nest blocks in blocks as far as you like. For every rule
defined in this block the values defined before this block
will apply. Usually you would define an often used parameter
as the protocol in front of this block, and anything special
inside it.
.Sp
You can put as many rules (using the <;> character) as you 
like insode this block. but there should always be one or
more, although you will get away with none. Not very
usefull except for when you frequently edit you config
file, and might want to leave a chain empty.
.Sp
Since the nesting block is left associative, it cannot be bound
to keys defined after the block.
.Sp
Example:
.Sp
.Vb 4
\&    chain INPUT proto tcp {
\&        syn DENY;
\&        ACCEPT;
\&    }
.Ve
This block shows two rules inside a block, which will both be merged
with anything in front of it, so you will get two rules:
.Sp
.Vb 2
\&    iptables -A INPUT -p tcp -y -j DENY
\&    iptables -A INPUT -p tcp -j ACCEPT
.Ve
.Ip "\fB$\fR" 8
Further more, ferm now supports variables, so you can define your
favorite targets, interfaces etc. before you use them. It works
like this:
.Sp
.Vb 3
\&    set IF eth0
\&    set $IF ACCEPT
\&    set TARGET $IF
.Ve
will result in this:
.Sp
.Vb 3
\&    $IF = eth0
\&    $eth0 = ACCEPT
\&    $TARGET = eth0
.Ve
.Ip "\fB()\fR" 8
The array symbol. Using the parentheses, you can define
a \*(L'list\*(R' of values that should be applied for the key to the
left of it.
.Sp
Example:
.Sp
.Vb 1
\&    proto ( tcp udp icmp )
.Ve
this will result in three rules:
.Sp
.Vb 5
\&    ... -p tcp ...
\&    ... -p udp ...
\&    ... -p icmp ...
\&    
\&Only values can be 'listed', so you cannot do something like this:
.Ve
.Vb 1
\&    proto tcp ( ACCEPT LOG );
.Ve
but you can do this:
.Sp
.Vb 1
\&    chain (INPUT OUTPUT FORWARD) proto (icmp,udp,tcp) DENY;
.Ve
(which will result in nine rules!)
.Sp
Values can be separated either by spaces or commas. The
array symbol is both left- and right-associative, in contrast
with the nesting block, which is left-associative only.
.Ip "\f(CW # \fR" 8
The comment symbol. Anything that follows this symbol up to
the end of line is ignored.
.PP
These symbols glue all the keywords into a structure, which
allows you to specify some keys only a few times, and let them
apply to any key/value pairs defined within an entire block, for
instance:
.PP
.Vb 5
\&    proto tcp {
\&        dport 22 ACCEPT;
\&        syn DPORT 0:1023 DENY;
\&        }
\&    ACCEPT;
.Ve
Now here, the \*(L'proto tcp\*(R' is valid within the block, but not anymore
after is, resulting in:
.PP
.Vb 3
\&    ... -p tcp --dport 22 -j accept
\&    ... -p tcp -y --dport 0:1023 -j deny
\&    ... -j accept # note '-p tcp' is not in here!
.Ve
\fBSome important notes:\fR
.PP
- Ferm inserts the rules \*(L'chronologically\*(R', so the first rule will
be inserted before the second one.
.PP
- Anything defined within a block is no longer valid when that block
ends.
.PP
- Everything defined within the current block that is \*(L'effectuated\*(R',
will be no longer defined immediately after that point.
.PP
- Everything defined before a block is undefined when this block 
closes.
.PP
If you do not understand this, don't worry, it alle becomes clear
by itself.
.PP
Two types of keys exist:
.Sh "Firewall keys"
Firewall keys define a set of firewall packet matching
criteria that is supported by the kernel backend. They
look like \*(L'name value\*(R' pairs or like \*(L'switch\*(R'. For
instance:
.Sp
.Vb 1
\&    proto tcp
.Ve
or:
.Sp
.Vb 1
\&    syn
.Ve
A \*(L'name value\*(R' pair lets you fill in a value for a certain
condition you would like to match packets against, switches
are like on/off light switches on the wall, if you specify
a switch, you turn paket matching for whatever the switch
stands, on. In the latter example, you turn \s-1SYN\s0\-packet
matching on for this rule.
.Sp
Both types can optionally be preceded by a \fB!\fR. This will
be handled that you don't want something to be matching
it:
.Sp
.Vb 1
\&    !syn
.Ve
or:
.Sp
.Vb 1
\&    ! syn
.Ve
Means you want packets which *don't* have the syn-flag set to
be matched. Or even:
.Sp
.Vb 1
\&    proto ! tcp
.Ve
Means you want to match *anything but* packets from the tcp
protocol.
.Sp
Read \fIiptables\fR\|(8) or \fIipchains\fR\|(8) to see where the \fB!\fR can be used.
.Sh "Option keys"
Using \fBoption\fR keys alter the behaviour of \fBferm\fR; they
can be used to e.g. clear chains before use, or turn off certain
sanity checks.
.Sp
Example:
.Sp
.Vb 1
\&  option verbose
.Ve
This option makes \fBferm\fR show a lot of information about what
it is doing.
.PP
The syntax is very simple, let's start with a simple
example:
.PP
.Vb 3
\&    chain input {
\&        proto tcp ACCEPT;
\&    }
.Ve
This will add a rule to the predefined input chain, matching
and accepting all tcp packets.  Ok, let's make it more complicated:
.PP
.Vb 3
\&    chain (input,output) {
\&        proto (udp,tcp) ACCEPT;
\&    }
.Ve
This will insert 4 rules, namely 2 in chain input, and 2 in
chain output, matching and accepting both udp and tcp packets.
Normally you would type this for \fIipchains\fR\|(8):
.PP
.Vb 4
\&   ipchains -A input -p tcp ACCEPT
\&   ipchains -A output -p tcp ACCEPT
\&   ipchains -A input -p udp ACCEPT
\&   ipchains -A output -p udp ACCEPT
.Ve
Note how much less typing we need to do? :\-)
.PP
Basically, this is all there is to it, although you can
make it quite more complex. Something to look at:
.PP
.Vb 4
\&   chain input policy ACCEPT {
\&       destination 10/8 port ! ftp goto mychain sport :1023 tos 4 settos 8 mark 2;
\&       destination 10/8 port ftp DENY;
\&   }
.Ve
My point here is, that *you* need to make nice rules, keep
them readable to you and others, and not make it into a mess.
.PP
It would aid the reader if the resulting firewall rules were placed here for
reference. Also, you could include the nested version with better
readability.
.PP
Try using comments to show what you are doing:
.PP
.Vb 3
\&    # this line enables transparent http-proxying for the internal network:
\&    proto tcp if eth0 daddr ! 192.168.0.0/255.255.255.0
\&        dport http REDIRECT 3128;
.Ve
You will be thankfull for it later!
.PP
.Vb 5
\&    chain input policy ACCEPT {
\&        interface (eth0,ppp0) {
\&            # deny access to notorius hackers, return here if
\&            # no match was found to resume normal firewalling
\&            goto badguys;
.Ve
.Vb 4
\&            protocol tcp goto fw_tcp;
\&            protocol udp goto fw_udp;
\&        }
\&    }
.Ve
The more you nest, the better it looks. Make sure the order you
specify is correct, you would not want to do this:
.PP
.Vb 4
\&    chain forward {
\&        proto ! udp DENY;
\&        proto tcp dport ftp ACCEPT;
\&    }
.Ve
because the second rule will never match. Best way is to specify
first everyting that is allowed, and then deny everything else.
Look at the examples for more good snapshots. Most people do
something like this:
.PP
.Vb 7
\&    proto tcp {
\&        dport (
\&            ssh http ftp
\&        ) ACCEPT;
\&        dport 1024:65535 ! syn ACCEPT;
\&        DROP;
\&    }
.Ve
.Sh "keywords"
To make life easy, \fBferm\fR allows you to use shorthands for
most keywords. A list of shorthand notations is available at the end
of this section.
.PP
What kind of value you provide for a keyword depends on the 
keyword entirely, e.g. \*(L'protocol\*(R' expects \*(L'tcp\*(R', \*(L'udp\*(R' or \*(L'icmp\*(R',
\&'log-prefix\*(R' expects a value like \*(L'"whoops, someone rang the
doorbell"\*(R' and \*(L'destination-port\*(R' can accept values like \*(L'http\*(R',
\&'80\*(R' or \*(L'0:1023\*(R'. Take a look at the kernel backend program
manual for possible values and how they look like.
.PP
Note you may put a value in single quotes or double quotes,
if this may be required because a value contains spaces:
.PP
.Vb 1
\&    log-prefix "Dropped tcp package: "
.Ve
Please don't use commas, exclamation commas, exclamation
marks, parentheses, curly brackets or pipe characters between
quotes, \fBferm\fR doesn't like that.
.Ip "\fBchain [chain-name]\fR" 8
Specifies a chain that this rule will be inserted to. this
is a required key for any rule. Chains can be
built in, like \f(CWinput\fR, \f(CWoutput\fR or \f(CWforward\fR, or user-defined
chains.
.Ip "\fBinterface [interface-name]\fR" 8
Define the interface name, your outside network card, like eth0,
or dialup like ppp1, or whatever device you want to match for
passing packets. It is equivalent to the \f(CW-i\fR switch in
\fIipchains\fR\|(8) and \fIiptables\fR\|(8).
.Ip "\fBouterface [interface-name]\fR" 8
Same as interface, only for matching the outgoing interface
for a packet, as in \fIiptables\fR\|(8). \fIipchains\fR\|(8) hasn't got this
parameter.
.Ip "\fBprotocol [protocol-name|protocol-number]\fR" 8
Currently supported by the kernel are tcp, udp and icmp, or
their respective numbers.
.Ip "\fBport [port-spec]\fR" 8
Specify a port number, name or range
.Ip "\fBaddr [address-spec]\fR" 8
Specify a network address, a hostname or ip-number.
.Ip "\fBsource|destination\fR" 8
Specify that the values provided for \fBport\fR and \fBaddr\fR
above should be either \fBsource\fR or <destination> ports
and addresses. This works like a toggle, which can be left on
for the entire configuration file. So, if you say \fBsource\fR once,
all occurences of \fBport\fR will be \fBsource port\fR's, as well as for
addresses.
.Ip "\fBsaddr|daddr [address-spec]\fR" 8
Specify an address specifically for the \fBsource\fR or \fBdestination\fR
side, read it as a shorthand for \fBsource address\fR and \fBdestination
address\fR, although it does not \*(L'toggle\*(R' the \fBsource|destination\fR
state, which is remembered.
.Ip "\fBsport|dport [port-spec]\fR" 8
Specify a port number, name or range for the \fBsource\fR or \fBdestination\fR
side, read it as a shorthand for \fBsource port\fR and \fBdestination
port\fR>, although it does not \*(L'toggle\*(R' the \fBsource|destination\fR
state, which is remembered. Ports can be specified for tcp and udp,
as well as icmp, only in that case it means \*(L'icmp-type\*(R' and only
works when you specify the type numerically.
.Sp
Note that you need to specify a protocol, before you can use
ports, that is because not all protocols support the ideas
of ports.
.Sp
Here are some examples of valid addresses:
.Sp
.Vb 3
\&    192.168/8 (identical to the next one:)
\&    192.168.0.0/255.255.255.0
\&    my.domain.com
.Ve
And some examples of valid ports/ranges:
.Sp
.Vb 5
\&    80
\&    http
\&    ssh:http
\&    0:1023        which is equivalent to     :1023
\&    1023:65535    which is equivalent to     1023:65535
.Ve
.Ip "\fBicmptype [type]\fR" 8
To specify an icmp message type. Can be numbers, but refer
to the manual of the kernel program to retreive a list,
for ipchains use \*(L"ipchains \f(CW-h\fR icmp\*(R". Examples: ping, pong.
.Ip "\fBtos [value]\fR" 8
Matches a packet on the specified \s-1TOS\s0\-value. See settos for
values.
.Ip "\fBsettos [value]\fR" 8
Set the tcp package Type Of Service bit to this value.
This will be used by whatever traffic scheduler is willing to,
mostly your own linux-machine, but maybe more. The original
tos-bits are blanked and overwritten by this value. Possible
values are (look in the shorthands for more, and easier
values) :
.Sp
02 04 08 10
.Ip "\fBmark [value]\fR" 8
matches packets based on their mark-value
.Ip "\fBsetmark [value]\fR" 8
Sets the mark-value for a packet, use with the \s-1MARK\s0 target in iptables
.Ip "\fBsyn\fR" 8
Specify that the \s-1SYN\s0 flag in a tcp package should be matched,
which are used to build new tcp connections. You can identify
incoming connections with this, and decide wether you want
to allow it or not. Packets that do not have this flag are
probably from an already established connection, so it's
considered reasonably safe to let these through.
.Ip "\fBfragment\fR" 8
Specify that only fragmented \s-1IP\s0 packets should be matched.
When packets are larger that the maximum packet size your
system can handle (called Maximum Transmission Unit or \s-1MTU\s0)
they will be chopped into bits and sent one by one as single
packets. See \fIifconfig\fR\|(8) if you want to find the \s-1MTU\s0 for
your system (the default is usually 1500 bytes).
.Sp
Fragments are frequently used in \s-1DOS\s0 attacks, because there
is no way of finding out the origin of a fragment packet.
.Ip "\fBpolicy [policy]\fR" 8
Specifies the default policy for the current chain. Can be
either of the standard actions (\s-1ACCEPT\s0, \s-1DENY\s0, \s-1REJECT\s0, \s-1MASQ\s0
and \s-1REDIRECT\s0). A packet that matches no rules will be treated
as specified by the policy. You can't specify chain names
here. Only the predefined (built-in) chains have policies.
.Sp
To avoid ambiguity, always specify the policies of all
predefined chains explicitly.
.Ip "\fBlog\fR" 8
Log all packets that match this rule in the kernel log. Be
carefull with log flooding. Note the difference with \fB\s-1LOG\s0\fR
in iptables! See \fB\s-1LOG\s0\fR as well. In iptables, this makes a
copy of the current rule, and inserts it with the \s-1LOG\s0 target
instead of any other specified target. 
.Sp
See also \fBlog-[level|prefix|tcp-sequence|tcp-options|ip-options]\fR
.Ip "\fBgoto [chain]\fR" 8
Specify that matching packets should jump to this chain, only user
defined chains are valid jump targets.
.Ip "\fBreverse\fR" 8
Instructs the kernel to use this rule twice, the second time with
source and destination swapped. Unfortunately, this doesn't work
with iptables.
.Ip "\fB\s-1LOG\s0\fR" 8
Identical to the \*(L'\s-1LOG\s0\*(R' target in iptables, logs any packet that
matches, but doesn't do anything else to it. Only valid for
iptables, otherwise use \*(L'log\*(R'. See \fBlog\fR and also
\fBlog-[level|prefix|tcp-sequence|tcp-options|ip-options]\fR.
.Ip "\fB\s-1ACCEPT\s0\fR" 8
Accepts matching packets.
.Ip "\fB\s-1REJECT\s0\fR" 8
Rejects matching packets.
.Ip "\fB\s-1DENY\s0\fR" 8
Denies matching packets.
.Ip "\fB\s-1MASQ\s0 [port|portrange]\fR" 8
Masquerades matching packets. Optionally followed by a port or
port-range for iptables. Specify as \*(L"123\*(R", \*(L"123-456\*(R" or \*(L"123:456\*(R".
The port range parameter specifies what local ports masqueraded
connections should originate from.
.Ip "\fB\s-1RETURN\s0\fR" 8
Returns to the parent chain where the current chain was called
if the packet matches.
.Ip "\fB\s-1REDIRECT\s0 [port|portrange]\fR " 8
Allows transparent proxying when rule matches, the port that is
redirected to must immediately follow this keyword. The target
may also be an \s-1IP\s0\-number in case you are using \fIiptables\fR\|(8), so
something like \*(L"\s-1REDIRECT\s0 192.168.0.5:21\*(R" is valid there.
.Ip "\fB\s-1SNAT\s0|\s-1DNAT\s0 [ip-address|ip-range|ip-port-range]\fR" 8
Allows source/destination address translation, only valid for
\fIiptables\fR\|(8), requires an ip-number, range or ip/port value.
.Ip "\fB\s-1TOS\s0\fR" 8
Changes the packets \s-1TOS\s0\-field according to the set-tos parameter
specified, only valid for iptables.
.Ip "\fBtable [table-name]\fR" 8
Selects this table for the rule. Valid table names are \*(L"filter\*(R",
\*(L"nat\*(R" and \*(L"mangle\*(R".
.Ip "\fBreject-with [value]\fR" 8
Rejects a packet with an \s-1ICMP\s0 value type message.
.Ip "\fBlimit [value]\fR" 8
Limits these type of packets to a maximim.
.Ip "\fBburst [value]\fR" 8
Limits bursts of these packets.
.Ip "\fBmac [value]\fR" 8
Matches packets originating from these mac-addresses.
.Ip "\fBstate [value]\fR" 8
Matches packets with this state. The value may be specified as
a normal ferm-list: \*(L"(\s-1ESTABLISHED\s0,\s-1RELATED\s0)\*(R" but \*(L"\s-1NEW:RELATED\s0\*(R",
and single values are also allowed.
.Ip "\fBtcp-flags [!] [flagmask] [flagmatch]\fR" 8
Specify tcp-flags, the \fB!\fR is optional and has to precede the mask,
mask and match are mandatory. The list of mask or match flags may
be specified as a normal ferm-list: \*(L"(\s-1SYN\s0,\s-1ACK\s0,\s-1RST\s0)\*(R", but \*(L"\s-1SYN:ACK:RST\s0\*(R"
and single values are also allowed.
.Ip "\fBtcp-option [value]\fR" 8
Specify a tcp-option for this rule.
.Ip "\fBlog-[level|prefix|tcp-sequence|tcp-options|ip-options] [value]\fR" 8
Specifies several extra tcp/ip options.
.Ip "\fB[u|g|p|s]id-owner [value]\fR" 8
Matches packets originating from this User, Group, Pid or Session \s-1ID\s0.
.Ip "\fBset [name] [value]\fR" 8
Set variable \*(L"name\*(R" to value \*(L"value\*(R", you can dereference the variables
by \*(L"$name\*(R". You may also put variables within \fBset\fR statements.
.SH "SHORTHANDS"
Here's a complete list of possible shorthands, just
to reduce the amount of typing:
.Ip "interface:" 4
if
.Ip "outerface:" 4
of
.Ip "protocol:" 4
proto
.Ip "source:" 4
src
.Ip "destination:" 4
dest
.Ip "fragment:" 4
frag
.Ip "\s-1ACCEPT\s0:" 4
accept
.Ip "\s-1DENY\s0:" 4
deny, \s-1DROP\s0, drop
.Ip "\s-1REJECT\s0:" 4
reject
.Ip "\s-1MASQ\s0:" 4
masq
.Ip "\s-1RETURN\s0:" 4
return
.Ip "\s-1REDIRECT\s0:" 4
redirect, \s-1PROXY\s0, proxy
.Ip "\s-1MARK\s0:" 4
mark
.Ip "\s-1QUEUE\s0:" 4
queue
.Ip "\s-1SNAT\s0:" 4
snat
.Ip "\s-1DNAT\s0:" 4
dnat
.Ip "goto:" 4
to, jump
.Ip "icmptype" 4
icmp-type
.Ip "reverse:" 4
bidirectional, swap
.Ip "tcp-option:" 4
tcpoption
.Ip "mac:" 4
mac-source, macsource
.Ip "burst:" 4
limit-burst, limitburst
.Ip "uid-owner:" 4
uidowner, uid
.Ip "gid-owner:" 4
gidowner, gid
.Ip "pid-owner:" 4
pidowner, pid
.Ip "sid-owner:" 4
sidowner, sid
.Ip "log-level:" 4
loglev
.Ip "log-prefix:" 4
logprefix
.Ip "log-tcp-sequence:" 4
logseq
.Ip "log-tcp-options:" 4
logtcpopt
.Ip "log-ip-options:" 4
logipopt
.Ip "reject-with:" 4
rejectwith
.Ip "setmark" 4
set-mark
.Ip "tos/settos-values:" 4
The following Type Of Services values may be given:
.Sp
.Vb 1
\&    mincost min-cost 2 02 0x02
.Ve
.Vb 1
\&    reliability reliable 4 04 0x04
.Ve
.Vb 1
\&    max-throughput maxthroughput 8 08 0x08
.Ve
.Vb 1
\&    lowdelay interactive min-delay 10 0x10
.Ve
.Vb 1
\&    clear 0 00 0x00
.Ve
.SH "OPTIONS"
Options can be specified with the \*(L"option\*(R" keyword, which
can be defined anywhere within the document. Although
that may be fine, you almost allways want to define
them at the beginning of your document, because the
behaviour changes at the moment they are specified.
.PP
All options can also be specified on the command line, which
has a few more available. The equivalent for the commandline
options that are also available in the firewall file is mentioned
in the firewall file options section.
.Sh "Command line options"
.Ip "\fB--noexec\fR" 12
Do not execute the \fIipchains\fR\|(8) or \fIiptables\fR\|(8) commands, but
skip instead. This way you can parse your data, use \fB--lines\fR
to view the output.
.Ip "\fB--lines\fR" 12
Show the firewall lines that were generated from the rules. They
will be shown just before they are executed, so if you get error
messages from \fIipchains\fR\|(8) etc., you can see which rule caused
the error.
.Ip "\fB--verbose\fR" 12
Shows some more details of the stages of execution of the program.
.Ip "\fB--relaxed\fR" 12
Do not fuzz about errors, instead continue and let \fIipchains\fR\|(8) etc.
give errors back.
.Ip "\fB--help\fR" 12
Show a brief list of available commandline options.
.Ip "\fB--version\fR" 12
Shows the version number of the program.
.Ip "\fB--use [ipchains|iptables|ipfwadm]\fR" 12
Use this kernel program to implement the rules into the kernel.
Also available as firewall file option \*(L"option [...]\*(R". This option
must be set, either on the commandline or in a ferm config file.
.Ip "\fB--automod\fR" 12
Automatically insert the correct module parameter when using iptables,
making the \fBmodule\fR parameter unnecessary
.Sh "Firewall file options"
.Ip "\fBoption clearall\fR" 8
Clears the entire firewall, deletes all user chains and flushes
the built in chains. Does not alter policies.
.Ip "\fBoption flushall\fR" 8
Flushes all chains but does not delete them.
.Ip "\fBoption flushchains\fR" 8
Flushes any chain which is defined in the setup, even
built-in chains are flushed when referred.
.Ip "\fBoption createchains\fR" 8
Creates any chain which is referred to, even when no rule is
specified for the chain, but is only referred by with a 
\*(L"goto\*(R" keyword.
.Ip "\fBoption automod\fR" 8
Automatically insert the correct module parameter when using iptables,
making the \fBmodule\fR parameter unnecessary
.Ip "\fBoption relaxed\fR" 8
Makes the program not whining over serious errors, although
that's not very handy because it will fail to install the
rules.
.Ip "\fBoption [iptables|ipchains|ipfwadm]\fR" 8
Define which kernel program you have to use to install rules.
This one is required, since on some systems, they can both
be present, or you want to use a wrapper for an older version.
Currently defaults to ipchains.
.SH "SEE ALSO"
\fIipchains\fR\|(8), \fIipfwadm\fR\|(8), \fIiptables\fR\|(8)
.SH "NOTES"
A good firewall is not the only step in security, even the
firewall may be insecure, or someone breaks into your house
and steals the hard disk out of your PC. Do not rely on this
firewall tool for the use of mission critical or confidential
data. It is not fit for such a purpose!
.PP
Instead, use this tool to expand your current use of \fIipchains\fR\|(8)
and routing, create a flexible firewall and look out for
anything suspicious. Be carefull with open ports and servers,
always get the latest, patched versions. Read more about
firewalls before experimenting, you are warned! You might
also read the COPYING file provided with the package or
visit www.gnu.org to find more about the license.
.SH "EXAMPLES"
The package comes with a directory full of goodies (examples)
that you can try, adjust for your system or just read if
you want to understand the syntax and it's possibilities.
Look in the \*(L"examples\*(R" directory.
.SH "REQUIREMENTS"
.Sh "Operating system"
The Operating system currently supported is only linux, although
it may be possible to port this program to support FreeBSD or
\s-1SOLARIS\s0 firewall systems, provided they supply a similar
firewalling scheme. (Does anybody known about that?)
.Sh "Software/packages"
Required are 2 packages: Perl5, under which this \fBferm\fR
runs, and one of the kernel firewall programs, suited for
your system and kernel version.
.Sh "Kernel"
The respective required kernel versions for each of the kernel
firewall programs (\fIipchains\fR\|(8), \fIipfwadm\fR\|(8) or \fIiptables\fR\|(8)) is also
needed. This means you have to have a kernel which can use the
firewalling thing, something you might have to compile a kernel
for, or set some switches in /proc. Look at the man pages of
those kernel programs for more information.
.SH "RESTRICTIONS"
\fBferm\fR allows almost anything the used firewall program
allows, so go ahead and specify complex port ranges, icmp
by number or worse. Just be warned.
.PP
Although quite sophisticated, the kernel interface programs
\fIipchains\fR\|(8) and \fIiptables\fR\|(8) are very limited in some respects.
\fBferm\fR is only an interface to improve the handling of
these programs, and is therefore limited by the possibilities
of these programs.
.PP
\fIIpfwadm\fR\|(8) is extremely limited in rule-building, upgrade or
succomb in it. Nothing \fBferm\fR can do about it.
.SH "BUGS"
The \fIipfwadm\fR\|(8) interface is really limited due to being unable to
test it and having no experience with it at all. I'll be
concentration on \fIiptables\fR\|(8), which supports much more options
and will be quite more flexible.
.PP
Several nasty cleanups are not done well, which may result
in surviving data. Tried to remove all of them but suspect
more of them to occur.
.PP
The --log-prefix construct does not allow certain characters to
be put between "". Make sure you don't use the bracket {} and []
characters, the ! and , are also not correctly parsed.
.SH "TODO"
* Improve \fIipfwadm\fR\|(8) handling or removing it altogether
.PP
* Add more examples, with modularized snipplets (include option)
.PP
* Make rpm's for RH and SuSE, or better: get you to do that!
.PP
* Review the second half of the manual page
.PP
* Make ferm bug you more about errors, i.e. increase validity
  checking to high levels
.SH "COPYRIGHT"
Copyright (C) 2001, Auke Kok <koka@geo.vu.nl>
.SH "LICENSE"
\fBferm\fR is released under the Gnu Public License, see the
COPYING file that came with the package or visit www.gnu.org.
.PP
This is free software; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.
.SH "AUTHOR"
Auke Kok (koka@geo.vu.nl)

.rn }` ''
.IX Title "FERM 1"
.IX Name "B<ferm> - a firewall rule parser for linux"

.IX Header "NAME"

.IX Header "SYNOPSYS"

.IX Header "DESCRIPTION"

.IX Header "STRUCTURE OF A FIREWALL FILE"

.IX Item "\fB;\fR"

.IX Item "\fB{}\fR"

.IX Item "\fB$\fR"

.IX Item "\fB()\fR"

.IX Item "\f(CW # \fR"

.IX Subsection "Firewall keys"

.IX Subsection "Option keys"

.IX Subsection "keywords"

.IX Item "\fBchain [chain-name]\fR"

.IX Item "\fBinterface [interface-name]\fR"

.IX Item "\fBouterface [interface-name]\fR"

.IX Item "\fBprotocol [protocol-name|protocol-number]\fR"

.IX Item "\fBport [port-spec]\fR"

.IX Item "\fBaddr [address-spec]\fR"

.IX Item "\fBsource|destination\fR"

.IX Item "\fBsaddr|daddr [address-spec]\fR"

.IX Item "\fBsport|dport [port-spec]\fR"

.IX Item "\fBicmptype [type]\fR"

.IX Item "\fBtos [value]\fR"

.IX Item "\fBsettos [value]\fR"

.IX Item "\fBmark [value]\fR"

.IX Item "\fBsetmark [value]\fR"

.IX Item "\fBsyn\fR"

.IX Item "\fBfragment\fR"

.IX Item "\fBpolicy [policy]\fR"

.IX Item "\fBlog\fR"

.IX Item "\fBgoto [chain]\fR"

.IX Item "\fBreverse\fR"

.IX Item "\fB\s-1LOG\s0\fR"

.IX Item "\fB\s-1ACCEPT\s0\fR"

.IX Item "\fB\s-1REJECT\s0\fR"

.IX Item "\fB\s-1DENY\s0\fR"

.IX Item "\fB\s-1MASQ\s0 [port|portrange]\fR"

.IX Item "\fB\s-1RETURN\s0\fR"

.IX Item "\fB\s-1REDIRECT\s0 [port|portrange]\fR "

.IX Item "\fB\s-1SNAT\s0|\s-1DNAT\s0 [ip-address|ip-range|ip-port-range]\fR"

.IX Item "\fB\s-1TOS\s0\fR"

.IX Item "\fBtable [table-name]\fR"

.IX Item "\fBreject-with [value]\fR"

.IX Item "\fBlimit [value]\fR"

.IX Item "\fBburst [value]\fR"

.IX Item "\fBmac [value]\fR"

.IX Item "\fBstate [value]\fR"

.IX Item "\fBtcp-flags [!] [flagmask] [flagmatch]\fR"

.IX Item "\fBtcp-option [value]\fR"

.IX Item "\fBlog-[level|prefix|tcp-sequence|tcp-options|ip-options] [value]\fR"

.IX Item "\fB[u|g|p|s]id-owner [value]\fR"

.IX Item "\fBset [name] [value]\fR"

.IX Header "SHORTHANDS"

.IX Item "interface:"

.IX Item "outerface:"

.IX Item "protocol:"

.IX Item "source:"

.IX Item "destination:"

.IX Item "fragment:"

.IX Item "\s-1ACCEPT\s0:"

.IX Item "\s-1DENY\s0:"

.IX Item "\s-1REJECT\s0:"

.IX Item "\s-1MASQ\s0:"

.IX Item "\s-1RETURN\s0:"

.IX Item "\s-1REDIRECT\s0:"

.IX Item "\s-1MARK\s0:"

.IX Item "\s-1QUEUE\s0:"

.IX Item "\s-1SNAT\s0:"

.IX Item "\s-1DNAT\s0:"

.IX Item "goto:"

.IX Item "icmptype"

.IX Item "reverse:"

.IX Item "tcp-option:"

.IX Item "mac:"

.IX Item "burst:"

.IX Item "uid-owner:"

.IX Item "gid-owner:"

.IX Item "pid-owner:"

.IX Item "sid-owner:"

.IX Item "log-level:"

.IX Item "log-prefix:"

.IX Item "log-tcp-sequence:"

.IX Item "log-tcp-options:"

.IX Item "log-ip-options:"

.IX Item "reject-with:"

.IX Item "setmark"

.IX Item "tos/settos-values:"

.IX Header "OPTIONS"

.IX Subsection "Command line options"

.IX Item "\fB--noexec\fR"

.IX Item "\fB--lines\fR"

.IX Item "\fB--verbose\fR"

.IX Item "\fB--relaxed\fR"

.IX Item "\fB--help\fR"

.IX Item "\fB--version\fR"

.IX Item "\fB--use [ipchains|iptables|ipfwadm]\fR"

.IX Item "\fB--automod\fR"

.IX Subsection "Firewall file options"

.IX Item "\fBoption clearall\fR"

.IX Item "\fBoption flushall\fR"

.IX Item "\fBoption flushchains\fR"

.IX Item "\fBoption createchains\fR"

.IX Item "\fBoption automod\fR"

.IX Item "\fBoption relaxed\fR"

.IX Item "\fBoption [iptables|ipchains|ipfwadm]\fR"

.IX Header "SEE ALSO"

.IX Header "NOTES"

.IX Header "EXAMPLES"

.IX Header "REQUIREMENTS"

.IX Subsection "Operating system"

.IX Subsection "Software/packages"

.IX Subsection "Kernel"

.IX Header "RESTRICTIONS"

.IX Header "BUGS"

.IX Header "TODO"

.IX Header "COPYRIGHT"

.IX Header "LICENSE"

.IX Header "AUTHOR"

